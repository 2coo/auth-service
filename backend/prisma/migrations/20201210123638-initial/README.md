# Migration `20201210123638-initial`

This migration has been generated by Tuvshinbayar Tuvhshinzul at 12/10/2020, 8:36:38 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `Tenant` (
`id` varchar(191)  NOT NULL ,
`domainName` varchar(191)  NOT NULL ,
`isAcitve` boolean  NOT NULL DEFAULT true,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `Tenant.domainName_unique`(`domainName`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Registration` (
`id` varchar(191)  NOT NULL ,
`userId` varchar(191)  NOT NULL ,
`applicationId` varchar(191)  NOT NULL ,
`username` varchar(191)  NOT NULL ,
`usernameStatus` ENUM('ACTIVE', 'PENDING', 'REJECTED')  NOT NULL DEFAULT 'PENDING',
`isVerified` boolean  NOT NULL DEFAULT false,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `Registration.userId_applicationId_unique`(`userId`,
`applicationId`),
UNIQUE INDEX `Registration.username_applicationId_unique`(`username`,
`applicationId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Application` (
`id` varchar(191)  NOT NULL ,
`tenantId` varchar(191)  NOT NULL ,
`name` varchar(191)  NOT NULL ,
`secret` varchar(191)  NOT NULL ,
`selfRegistrationEnabled` boolean  NOT NULL DEFAULT false,
`refreshTokenLifetime` int  NOT NULL DEFAULT 43200,
`accessTokenLifetime` int  NOT NULL DEFAULT 60,
`idTokenLifetime` int  NOT NULL DEFAULT 5,
`logo` varchar(191)  ,
`trustedApplication` boolean  NOT NULL DEFAULT false,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `Application.tenantId_name_unique`(`tenantId`,
`name`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `SelfRegistrationFields` (
`id` varchar(191)  NOT NULL ,
`fieldName` varchar(191)  NOT NULL ,
`fieldType` varchar(191)  ,
`isRequired` boolean  NOT NULL DEFAULT false,
`isEnabled` boolean  NOT NULL DEFAULT false,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
`applicationId` varchar(191)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Scope` (
`id` varchar(191)  NOT NULL ,
`name` varchar(191)  NOT NULL ,
`description` varchar(191)  ,
`isCustomScope` boolean  NOT NULL DEFAULT false,
`ResourceServerId` varchar(191)  ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `Scope.name_unique`(`name`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Grant` (
`id` varchar(191)  NOT NULL ,
`grantType` ENUM('AUTHORIZATION_CODE', 'PASSWORD', 'REFRESH_TOKEN', 'CLIENT_CREDENTIALS', 'EXTENSION')  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `Grant.grantType_unique`(`grantType`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `RedirectURI` (
`id` varchar(191)  NOT NULL ,
`ApplicationId` varchar(191)  NOT NULL ,
`url` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `JavascriptOrigin` (
`id` varchar(191)  NOT NULL ,
`ApplicationId` varchar(191)  NOT NULL ,
`uri` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ResourceServer` (
`id` varchar(191)  NOT NULL ,
`name` varchar(191)  NOT NULL ,
`identifier` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `ResourceServer.identifier_unique`(`identifier`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `AccessToken` (
`id` varchar(191)  NOT NULL ,
`jti` varchar(191)  NOT NULL ,
`expirationDate` datetime(3)  NOT NULL ,
`userId` varchar(191)  ,
`ApplicationId` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `AccessToken.jti_unique`(`jti`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `RefreshToken` (
`id` varchar(191)  NOT NULL ,
`refreshToken` varchar(191)  NOT NULL ,
`expirationDate` datetime(3)  NOT NULL ,
`userId` varchar(191)  NOT NULL ,
`ApplicationId` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `RefreshToken.refreshToken_unique`(`refreshToken`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `AuthorizationCode` (
`id` varchar(191)  NOT NULL ,
`code` varchar(191)  NOT NULL ,
`expirationDate` datetime(3)  NOT NULL ,
`redirectURI` varchar(191)  NOT NULL ,
`userId` varchar(191)  NOT NULL ,
`ApplicationId` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `AuthorizationCode.code_unique`(`code`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Group` (
`id` varchar(191)  NOT NULL ,
`tenantId` varchar(191)  NOT NULL ,
`name` varchar(191)  NOT NULL ,
`description` varchar(191)  ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `Group.name_unique`(`name`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Role` (
`id` varchar(191)  NOT NULL ,
`applicationId` varchar(191)  NOT NULL ,
`name` varchar(191)  NOT NULL ,
`description` varchar(191)  ,
`isDefault` boolean  NOT NULL DEFAULT false,
`isSuperRole` boolean  NOT NULL DEFAULT false,
`permissions` varchar(191)  ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `Role.name_applicationId_unique`(`name`,
`applicationId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `User` (
`id` varchar(191)  NOT NULL ,
`tenantId` varchar(191)  NOT NULL ,
`username` varchar(191)  NOT NULL ,
`usernameStatus` ENUM('ACTIVE', 'PENDING', 'REJECTED')  NOT NULL DEFAULT 'PENDING',
`email` varchar(191)  NOT NULL ,
`password` varchar(191)  NOT NULL ,
`salt` varchar(191)  NOT NULL ,
`accountStatusType` ENUM('UNCONFIRMED', 'CONFIRMED', 'ARCHIVED', 'COMPROMISED', 'UNKNOWN', 'RESET_REQUIRED', 'FORCE_CHANGE_PASSWORD', 'DISABLED')  NOT NULL DEFAULT 'UNCONFIRMED',
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `User.username_unique`(`username`),
UNIQUE INDEX `User.email_unique`(`email`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `IdProviderOnApplication` (
`id` varchar(191)  NOT NULL ,
`isEnabled` boolean  NOT NULL DEFAULT true,
`isOverwritten` boolean  NOT NULL DEFAULT false,
`providerType` ENUM('GOOGLE', 'FACEBOOK', 'APPLE')  NOT NULL ,
`data` json  ,
`identityProviderId` varchar(191)  NOT NULL ,
`applicationId` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `IdentityProvider` (
`id` varchar(191)  NOT NULL ,
`isEnabled` boolean  NOT NULL DEFAULT true,
`providerType` ENUM('GOOGLE', 'FACEBOOK', 'APPLE')  NOT NULL ,
`data` json  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ExternalIdentifier` (
`id` varchar(191)  NOT NULL ,
`tenantId` varchar(191)  NOT NULL ,
`applicationId` varchar(191)  NOT NULL ,
`data` json  ,
`providerType` ENUM('GOOGLE', 'FACEBOOK', 'APPLE')  NOT NULL ,
`userId` varchar(191)  NOT NULL ,
`status` ENUM('UNCONFIRMED', 'CONFIRMED', 'DISABLED')  NOT NULL DEFAULT 'CONFIRMED',
`isUserCreatedBefore` boolean  NOT NULL ,
`identityProviderId` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Profile` (
`id` varchar(191)  NOT NULL ,
`userId` varchar(191)  NOT NULL ,
`firstName` varchar(191)  DEFAULT '',
`lastName` varchar(191)  DEFAULT '',
`displayName` varchar(191)  ,
`birthdate` datetime(3)  ,
`gender` ENUM('FEMALE', 'MALE', 'OTHER')  ,
`mobileNumber` varchar(191)  ,
`picture` varchar(191)  ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `Profile_userId_unique`(`userId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `UserCustomAttribute` (
`name` varchar(191)  NOT NULL ,
`value` varchar(191)  NOT NULL ,
`profileId` varchar(191)  NOT NULL ,
PRIMARY KEY (`name`,`profileId`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `RememberMe` (
`id` varchar(191)  NOT NULL ,
`token` varchar(191)  NOT NULL ,
`userId` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
UNIQUE INDEX `RememberMe.token_unique`(`token`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `PasswordReset` (
`id` varchar(191)  NOT NULL ,
`userId` varchar(191)  NOT NULL ,
`token` varchar(191)  NOT NULL ,
`expirationDate` datetime(3)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `EmailSettings` (
`id` varchar(191)  NOT NULL ,
`tenantId` varchar(191)  NOT NULL ,
`host` varchar(191)  NOT NULL ,
`port` varchar(191)  NOT NULL ,
`username` varchar(191)  ,
`password` varchar(191)  ,
`secure` boolean  NOT NULL DEFAULT false,
`SMTPSecurity` ENUM('NONE', 'TLS', 'SSL')  NOT NULL DEFAULT 'NONE',
`ciphers` varchar(191)  ,
`from` varchar(191)  NOT NULL ,
`name` varchar(191)  ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
UNIQUE INDEX `EmailSettings_tenantId_unique`(`tenantId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `FailedLogin` (
`id` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`userId` varchar(191)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `UserDevice` (
`id` varchar(191)  NOT NULL ,
`userId` varchar(191)  NOT NULL ,
`deviceKey` varchar(191)  NOT NULL ,
`name` varchar(191)  ,
`lastIP` varchar(191)  NOT NULL ,
`isRemembered` boolean  NOT NULL DEFAULT false,
`SDK` varchar(191)  ,
`lastSeen` datetime(3)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_RegistrationToRole` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_RegistrationToRole_AB_unique`(`A`,
`B`),
INDEX `_RegistrationToRole_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_ApplicationToGrant` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_ApplicationToGrant_AB_unique`(`A`,
`B`),
INDEX `_ApplicationToGrant_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_ApplicationToScope` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_ApplicationToScope_AB_unique`(`A`,
`B`),
INDEX `_ApplicationToScope_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_AccessTokenToScope` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_AccessTokenToScope_AB_unique`(`A`,
`B`),
INDEX `_AccessTokenToScope_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_AuthorizationCodeToScope` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_AuthorizationCodeToScope_AB_unique`(`A`,
`B`),
INDEX `_AuthorizationCodeToScope_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_RefreshTokenToScope` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_RefreshTokenToScope_AB_unique`(`A`,
`B`),
INDEX `_RefreshTokenToScope_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_GroupToRole` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_GroupToRole_AB_unique`(`A`,
`B`),
INDEX `_GroupToRole_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_GroupToUser` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_GroupToUser_AB_unique`(`A`,
`B`),
INDEX `_GroupToUser_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_RoleHierarchy` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_RoleHierarchy_AB_unique`(`A`,
`B`),
INDEX `_RoleHierarchy_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `Registration` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Registration` ADD FOREIGN KEY (`applicationId`) REFERENCES `Application`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Application` ADD FOREIGN KEY (`tenantId`) REFERENCES `Tenant`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `SelfRegistrationFields` ADD FOREIGN KEY (`applicationId`) REFERENCES `Application`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Scope` ADD FOREIGN KEY (`ResourceServerId`) REFERENCES `ResourceServer`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `RedirectURI` ADD FOREIGN KEY (`ApplicationId`) REFERENCES `Application`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `JavascriptOrigin` ADD FOREIGN KEY (`ApplicationId`) REFERENCES `Application`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `AccessToken` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `AccessToken` ADD FOREIGN KEY (`ApplicationId`) REFERENCES `Application`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `RefreshToken` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `RefreshToken` ADD FOREIGN KEY (`ApplicationId`) REFERENCES `Application`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `AuthorizationCode` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `AuthorizationCode` ADD FOREIGN KEY (`ApplicationId`) REFERENCES `Application`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Group` ADD FOREIGN KEY (`tenantId`) REFERENCES `Tenant`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Role` ADD FOREIGN KEY (`applicationId`) REFERENCES `Application`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `User` ADD FOREIGN KEY (`tenantId`) REFERENCES `Tenant`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `IdProviderOnApplication` ADD FOREIGN KEY (`identityProviderId`) REFERENCES `IdentityProvider`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `IdProviderOnApplication` ADD FOREIGN KEY (`applicationId`) REFERENCES `Application`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ExternalIdentifier` ADD FOREIGN KEY (`tenantId`) REFERENCES `Tenant`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ExternalIdentifier` ADD FOREIGN KEY (`applicationId`) REFERENCES `Application`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ExternalIdentifier` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ExternalIdentifier` ADD FOREIGN KEY (`identityProviderId`) REFERENCES `IdentityProvider`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Profile` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `UserCustomAttribute` ADD FOREIGN KEY (`profileId`) REFERENCES `Profile`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `RememberMe` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `PasswordReset` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `EmailSettings` ADD FOREIGN KEY (`tenantId`) REFERENCES `Tenant`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `FailedLogin` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `UserDevice` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RegistrationToRole` ADD FOREIGN KEY (`A`) REFERENCES `Registration`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RegistrationToRole` ADD FOREIGN KEY (`B`) REFERENCES `Role`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_ApplicationToGrant` ADD FOREIGN KEY (`A`) REFERENCES `Application`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_ApplicationToGrant` ADD FOREIGN KEY (`B`) REFERENCES `Grant`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_ApplicationToScope` ADD FOREIGN KEY (`A`) REFERENCES `Application`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_ApplicationToScope` ADD FOREIGN KEY (`B`) REFERENCES `Scope`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_AccessTokenToScope` ADD FOREIGN KEY (`A`) REFERENCES `AccessToken`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_AccessTokenToScope` ADD FOREIGN KEY (`B`) REFERENCES `Scope`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_AuthorizationCodeToScope` ADD FOREIGN KEY (`A`) REFERENCES `AuthorizationCode`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_AuthorizationCodeToScope` ADD FOREIGN KEY (`B`) REFERENCES `Scope`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RefreshTokenToScope` ADD FOREIGN KEY (`A`) REFERENCES `RefreshToken`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RefreshTokenToScope` ADD FOREIGN KEY (`B`) REFERENCES `Scope`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_GroupToRole` ADD FOREIGN KEY (`A`) REFERENCES `Group`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_GroupToRole` ADD FOREIGN KEY (`B`) REFERENCES `Role`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_GroupToUser` ADD FOREIGN KEY (`A`) REFERENCES `Group`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_GroupToUser` ADD FOREIGN KEY (`B`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RoleHierarchy` ADD FOREIGN KEY (`A`) REFERENCES `Role`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RoleHierarchy` ADD FOREIGN KEY (`B`) REFERENCES `Role`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201210123638-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,409 @@
+// This is your Prisma schema file,
+// learn more about it in the docs https//pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "mysql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Tenant {
+  id                 String               @id @default(uuid())
+  domainName         String               @unique
+  isAcitve           Boolean              @default(true)
+  Applications       Application[]
+  Users              User[]
+  ExternalIdentifier ExternalIdentifier[]
+  Groups             Group[]
+  EmailSettings      EmailSettings?
+  createdAt          DateTime             @default(now())
+  updatedAt          DateTime             @updatedAt
+}
+
+enum UsernameStatus {
+  ACTIVE
+  PENDING
+  REJECTED
+}
+
+model Registration {
+  id             String         @id @default(uuid())
+  User           User           @relation(fields: [userId], references: [id])
+  userId         String
+  Application    Application    @relation(fields: [applicationId], references: [id])
+  applicationId  String
+  username       String
+  usernameStatus UsernameStatus @default(PENDING)
+  Roles          Role[]
+  isVerified     Boolean        @default(false)
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@unique([userId, applicationId])
+  @@unique([username, applicationId])
+}
+
+model Application {
+  id                      String                    @id @default(uuid())
+  Tenant                  Tenant                    @relation(fields: [tenantId], references: [id])
+  tenantId                String
+  Registrations           Registration[]
+  ExternalIdentifier      ExternalIdentifier[]
+  Roles                   Role[]
+  name                    String
+  secret                  String                    @default(cuid())
+  selfRegistrationEnabled Boolean                   @default(false)
+  SelfRegistrationFields  SelfRegistrationFields[]
+  IdentityProviders       IdProviderOnApplication[]
+  Grants                  Grant[]
+  RedirectUris            RedirectURI[]
+  JavascriptOrigins       JavascriptOrigin[]
+  EnabledScopes           Scope[]
+  AccessTokens            AccessToken[]
+  AuthorizationCodes      AuthorizationCode[]
+  RefreshTokens           RefreshToken[]
+  refreshTokenLifetime    Int                       @default(43200)
+  accessTokenLifetime     Int                       @default(60)
+  idTokenLifetime         Int                       @default(5)
+  logo                    String?
+  trustedApplication      Boolean                   @default(false)
+  createdAt               DateTime                  @default(now())
+  updatedAt               DateTime                  @updatedAt
+
+  @@unique([tenantId, name])
+}
+
+model SelfRegistrationFields {
+  id            String      @id @default(uuid())
+  Application   Application @relation(fields: [applicationId], references: [id])
+  fieldName     String
+  fieldType     String?
+  isRequired    Boolean     @default(false)
+  isEnabled     Boolean     @default(false)
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+  applicationId String
+}
+
+model Scope {
+  id                 String              @id @default(uuid())
+  name               String              @unique
+  description        String?
+  isCustomScope      Boolean             @default(false)
+  ResourceServer     ResourceServer?     @relation(fields: [ResourceServerId], references: [id])
+  ResourceServerId   String?
+  Applications       Application[]
+  AccessTokens       AccessToken[]
+  AuthorizationCodes AuthorizationCode[]
+  RefreshTokens      RefreshToken[]
+  createdAt          DateTime            @default(now())
+  updatedAt          DateTime            @updatedAt
+}
+
+enum GrantType {
+  AUTHORIZATION_CODE
+  PASSWORD
+  REFRESH_TOKEN
+  CLIENT_CREDENTIALS
+  EXTENSION
+}
+
+model Grant {
+  id           String        @id @default(uuid())
+  grantType    GrantType     @unique
+  Applications Application[]
+  createdAt    DateTime      @default(now())
+  updatedAt    DateTime      @updatedAt
+}
+
+model RedirectURI {
+  id            String      @id @default(uuid())
+  Application   Application @relation(fields: [ApplicationId], references: [id])
+  ApplicationId String
+  url           String
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+}
+
+model JavascriptOrigin {
+  id            String      @id @default(uuid())
+  Application   Application @relation(fields: [ApplicationId], references: [id])
+  ApplicationId String
+  uri           String
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+}
+
+model ResourceServer {
+  id         String   @id @default(uuid())
+  name       String
+  identifier String   @unique
+  Scopes     Scope[]
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+}
+
+model AccessToken {
+  id             String      @id @default(uuid())
+  jti            String      @unique
+  expirationDate DateTime
+  Scopes         Scope[]
+  User           User?       @relation(fields: [userId], references: [id])
+  userId         String?
+  Application    Application @relation(fields: [ApplicationId], references: [id])
+  ApplicationId  String
+  createdAt      DateTime    @default(now())
+  updatedAt      DateTime    @updatedAt
+}
+
+model RefreshToken {
+  id             String      @id @default(uuid())
+  refreshToken   String      @unique @default(uuid())
+  expirationDate DateTime
+  Scopes         Scope[]
+  User           User        @relation(fields: [userId], references: [id])
+  userId         String
+  Application    Application @relation(fields: [ApplicationId], references: [id])
+  ApplicationId  String
+  createdAt      DateTime    @default(now())
+  updatedAt      DateTime    @updatedAt
+}
+
+model AuthorizationCode {
+  id             String      @id @default(uuid())
+  code           String      @unique @default(cuid(16))
+  expirationDate DateTime
+  redirectURI    String
+  Scopes         Scope[]
+  User           User        @relation(fields: [userId], references: [id])
+  userId         String
+  Application    Application @relation(fields: [ApplicationId], references: [id])
+  ApplicationId  String
+  createdAt      DateTime    @default(now())
+  updatedAt      DateTime    @updatedAt
+}
+
+enum Gender {
+  FEMALE
+  MALE
+  OTHER
+}
+
+model Group {
+  id          String   @id @default(uuid())
+  Tenant      Tenant   @relation(fields: [tenantId], references: [id])
+  tenantId    String
+  name        String   @unique
+  description String?
+  Roles       Role[]
+  Users       User[]
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+}
+
+model Role {
+  id            String         @id @default(uuid())
+  Application   Application    @relation(fields: [applicationId], references: [id])
+  applicationId String
+  name          String
+  description   String?
+  isDefault     Boolean        @default(false)
+  isSuperRole   Boolean        @default(false)
+  Registrations Registration[]
+  Groups        Group[]
+  permissions   String?
+  ParentRoles   Role[]         @relation("RoleHierarchy", references: [id])
+  ChildRoles    Role[]         @relation("RoleHierarchy", references: [id])
+  createdAt     DateTime       @default(now())
+  updatedAt     DateTime       @updatedAt
+
+  @@unique([name, applicationId])
+}
+
+enum AccountStatusType {
+  UNCONFIRMED
+  CONFIRMED
+  ARCHIVED
+  COMPROMISED
+  UNKNOWN
+  RESET_REQUIRED
+  FORCE_CHANGE_PASSWORD
+  DISABLED
+}
+
+model User {
+  id                  String               @id @default(uuid())
+  Tenant              Tenant               @relation(fields: [tenantId], references: [id])
+  tenantId            String
+  username            String               @unique @default(cuid())
+  usernameStatus      UsernameStatus       @default(PENDING)
+  email               String               @unique
+  password            String
+  salt                String
+  //
+  accountStatusType   AccountStatusType    @default(UNCONFIRMED)
+  ExternalIdentifiers ExternalIdentifier[]
+  //
+  Profile             Profile?
+  PasswordResets      PasswordReset[]
+  Devices             UserDevice[]
+  AccessTokens        AccessToken[]
+  AuthorizationCodes  AuthorizationCode[]
+  RefreshTokens       RefreshToken[]
+  Groups              Group[]
+  FailedLogins        FailedLogin[]
+  Registrations       Registration[]
+  createdAt           DateTime             @default(now())
+  updatedAt           DateTime             @updatedAt
+  RememberMe          RememberMe[]
+}
+
+enum SupportedProvider {
+  GOOGLE
+  FACEBOOK
+  APPLE
+}
+
+model IdProviderOnApplication {
+  id            String            @id @default(uuid())
+  isEnabled     Boolean           @default(true)
+  isOverwritten Boolean           @default(false)
+  providerType  SupportedProvider
+  data          Json?
+
+  IdentityProvider   IdentityProvider @relation(fields: [identityProviderId], references: [id])
+  Application        Application      @relation(fields: [applicationId], references: [id])
+  identityProviderId String
+  applicationId      String
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+}
+
+model IdentityProvider {
+  id                  String                    @id @default(uuid())
+  isEnabled           Boolean                   @default(true)
+  providerType        SupportedProvider
+  data                Json
+  Applications        IdProviderOnApplication[]
+  ExternalIdentifiers ExternalIdentifier[]
+  createdAt           DateTime                  @default(now())
+  updatedAt           DateTime                  @updatedAt
+
+}
+
+enum ExternalIdentifierStatus {
+  UNCONFIRMED
+  CONFIRMED
+  DISABLED
+}
+
+model ExternalIdentifier {
+  id                  String                   @id @default(uuid())
+  Tenant              Tenant                   @relation(fields: [tenantId], references: [id])
+  tenantId            String
+  Application         Application              @relation(fields: [applicationId], references: [id])
+  applicationId       String
+  data                Json?
+  providerType        SupportedProvider
+  User                User                     @relation(fields: [userId], references: [id])
+  userId              String
+  status              ExternalIdentifierStatus @default(CONFIRMED)
+  isUserCreatedBefore Boolean
+  IdentityProvider    IdentityProvider         @relation(fields: [identityProviderId], references: [id])
+  identityProviderId  String
+  createdAt           DateTime                 @default(now())
+  updatedAt           DateTime                 @updatedAt
+}
+
+model Profile {
+  id                   String                @id @default(uuid())
+  User                 User                  @relation(fields: [userId], references: [id])
+  userId               String
+  firstName            String?               @default("")
+  lastName             String?               @default("")
+  displayName          String?
+  birthdate            DateTime?
+  gender               Gender?
+  mobileNumber         String?
+  picture              String?
+  UserCustomAttributes UserCustomAttribute[]
+  createdAt            DateTime              @default(now())
+  updatedAt            DateTime              @updatedAt
+}
+
+model UserCustomAttribute {
+  name      String
+  value     String
+  Profile   Profile @relation(fields: [profileId], references: [id])
+  profileId String
+
+  @@id([name, profileId])
+}
+
+model RememberMe {
+  id        String   @id @default(uuid())
+  token     String   @unique
+  User      User     @relation(fields: [userId], references: [id])
+  userId    String
+  createdAt DateTime @default(now())
+}
+
+model PasswordReset {
+  id             String   @id @default(uuid())
+  User           User     @relation(fields: [userId], references: [id])
+  userId         String
+  token          String
+  expirationDate DateTime
+  createdAt      DateTime @default(now())
+  updatedAt      DateTime @updatedAt
+}
+
+enum SMTPSecurity {
+  NONE
+  TLS
+  SSL
+}
+
+model EmailSettings {
+  id           String       @id @default(uuid())
+  Tenant       Tenant       @relation(fields: [tenantId], references: [id])
+  tenantId     String
+  host         String
+  port         String
+  username     String?
+  password     String?
+  secure       Boolean      @default(false)
+  SMTPSecurity SMTPSecurity @default(NONE)
+  ciphers      String?
+  from         String
+  name         String?
+  createdAt    DateTime     @default(now())
+  updatedAt    DateTime     @updatedAt
+}
+
+model FailedLogin {
+  id        String   @id @default(uuid())
+  User      User     @relation(fields: [userId], references: [id])
+  createdAt DateTime @default(now())
+  userId    String
+}
+
+model UserDevice {
+  id           String   @id @default(uuid())
+  User         User     @relation(fields: [userId], references: [id])
+  userId       String
+  deviceKey    String
+  name         String?
+  lastIP       String
+  isRemembered Boolean  @default(false)
+  SDK          String?
+  lastSeen     DateTime
+  createdAt    DateTime @default(now())
+  updatedAt    DateTime @updatedAt
+}
```


