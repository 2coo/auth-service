# Migration `20201102054345-initial`

This migration has been generated by Tuvshinbayar Tuvhshinzul at 11/2/2020, 1:43:45 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `Photo` (
`id` varchar(191)  NOT NULL ,
`value` varchar(191)  NOT NULL ,
`isCurrentProfileImage` boolean  NOT NULL ,
`profileId` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `PasswordReset` (
`id` varchar(191)  NOT NULL ,
`userId` varchar(191)  NOT NULL ,
`token` varchar(191)  NOT NULL ,
`expirationDate` datetime(3)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `UserDevice` (
`id` varchar(191)  NOT NULL ,
`userId` varchar(191)  NOT NULL ,
`deviceKey` varchar(191)  NOT NULL ,
`name` varchar(191)  ,
`lastIP` varchar(191)  NOT NULL ,
`isRemembered` boolean  NOT NULL DEFAULT false,
`SDK` varchar(191)  ,
`lastSeen` datetime(3)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_RoleToUser` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_RoleToUser_AB_unique`(`A`,
`B`),
INDEX `_RoleToUser_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_GroupToRole` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_GroupToRole_AB_unique`(`A`,
`B`),
INDEX `_GroupToRole_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_RoleTooAuthScope` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_RoleTooAuthScope_AB_unique`(`A`,
`B`),
INDEX `_RoleTooAuthScope_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_RoleTooAuthCustomScope` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_RoleTooAuthCustomScope_AB_unique`(`A`,
`B`),
INDEX `_RoleTooAuthCustomScope_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_oAuthClientTooAuthGrant` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_oAuthClientTooAuthGrant_AB_unique`(`A`,
`B`),
INDEX `_oAuthClientTooAuthGrant_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_oAuthClientTooAuthScope` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_oAuthClientTooAuthScope_AB_unique`(`A`,
`B`),
INDEX `_oAuthClientTooAuthScope_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_oAuthAccessTokenTooAuthScope` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_oAuthAccessTokenTooAuthScope_AB_unique`(`A`,
`B`),
INDEX `_oAuthAccessTokenTooAuthScope_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_oAuthAuthorizationCodeTooAuthScope` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_oAuthAuthorizationCodeTooAuthScope_AB_unique`(`A`,
`B`),
INDEX `_oAuthAuthorizationCodeTooAuthScope_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_oAuthRefreshTokenTooAuthScope` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_oAuthRefreshTokenTooAuthScope_AB_unique`(`A`,
`B`),
INDEX `_oAuthRefreshTokenTooAuthScope_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_GroupToUser` (
`A` varchar(191)  NOT NULL ,
`B` varchar(191)  NOT NULL ,
UNIQUE INDEX `_GroupToUser_AB_unique`(`A`,
`B`),
INDEX `_GroupToUser_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `Photo` ADD FOREIGN KEY (`profileId`) REFERENCES `Profile`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `PasswordReset` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `UserDevice` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RoleToUser` ADD FOREIGN KEY (`A`) REFERENCES `Role`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RoleToUser` ADD FOREIGN KEY (`B`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_GroupToRole` ADD FOREIGN KEY (`A`) REFERENCES `Group`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_GroupToRole` ADD FOREIGN KEY (`B`) REFERENCES `Role`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RoleTooAuthScope` ADD FOREIGN KEY (`A`) REFERENCES `Role`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RoleTooAuthScope` ADD FOREIGN KEY (`B`) REFERENCES `oAuthScope`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RoleTooAuthCustomScope` ADD FOREIGN KEY (`A`) REFERENCES `Role`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RoleTooAuthCustomScope` ADD FOREIGN KEY (`B`) REFERENCES `oAuthCustomScope`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_oAuthClientTooAuthGrant` ADD FOREIGN KEY (`A`) REFERENCES `oAuthClient`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_oAuthClientTooAuthGrant` ADD FOREIGN KEY (`B`) REFERENCES `oAuthGrant`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_oAuthClientTooAuthScope` ADD FOREIGN KEY (`A`) REFERENCES `oAuthClient`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_oAuthClientTooAuthScope` ADD FOREIGN KEY (`B`) REFERENCES `oAuthScope`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_oAuthAccessTokenTooAuthScope` ADD FOREIGN KEY (`A`) REFERENCES `oAuthAccessToken`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_oAuthAccessTokenTooAuthScope` ADD FOREIGN KEY (`B`) REFERENCES `oAuthScope`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_oAuthAuthorizationCodeTooAuthScope` ADD FOREIGN KEY (`A`) REFERENCES `oAuthAuthorizationCode`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_oAuthAuthorizationCodeTooAuthScope` ADD FOREIGN KEY (`B`) REFERENCES `oAuthScope`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_oAuthRefreshTokenTooAuthScope` ADD FOREIGN KEY (`A`) REFERENCES `oAuthRefreshToken`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_oAuthRefreshTokenTooAuthScope` ADD FOREIGN KEY (`B`) REFERENCES `oAuthScope`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_GroupToUser` ADD FOREIGN KEY (`A`) REFERENCES `Group`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_GroupToUser` ADD FOREIGN KEY (`B`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Email` ADD FOREIGN KEY (`profileId`) REFERENCES `Profile`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Group` ADD FOREIGN KEY (`userPoolId`) REFERENCES `UserPool`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `oAuthAccessToken` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `oAuthAccessToken` ADD FOREIGN KEY (`oAuthClientId`) REFERENCES `oAuthClient`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `oAuthAuthorizationCode` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `oAuthAuthorizationCode` ADD FOREIGN KEY (`oAuthClientId`) REFERENCES `oAuthClient`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `oAuthClient` ADD FOREIGN KEY (`userPoolId`) REFERENCES `UserPool`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `oAuthCustomScope` ADD FOREIGN KEY (`oAuthResourceServerId`) REFERENCES `oAuthResourceServer`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `oAuthJavascriptOrigin` ADD FOREIGN KEY (`oAuthClientId`) REFERENCES `oAuthClient`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `oAuthRedirectURI` ADD FOREIGN KEY (`oAuthClientId`) REFERENCES `oAuthClient`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `oAuthRefreshToken` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `oAuthRefreshToken` ADD FOREIGN KEY (`oAuthClientId`) REFERENCES `oAuthClient`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `oAuthResourceServer` ADD FOREIGN KEY (`userPoolId`) REFERENCES `UserPool`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `oAuthResourceServer` ADD FOREIGN KEY (`oAuthClientId`) REFERENCES `oAuthClient`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Profile` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Role` ADD FOREIGN KEY (`userPoolId`) REFERENCES `UserPool`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `User` ADD FOREIGN KEY (`userPoolId`) REFERENCES `UserPool`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `UserPool` ADD FOREIGN KEY (`organizationId`) REFERENCES `Organization`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201102054345-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,291 @@
+// This is your Prisma schema file,
+// learn more about it in the docs https//pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "mysql"
+  url = "***"
+}
+
+generator client {
+  provider        = "prisma-client-js"
+  previewFeatures = ["transactionApi", "connectOrCreate"]
+}
+
+enum GrantType {
+  AUTHORIZATION_CODE
+  PASSWORD
+  REFRESH_TOKEN
+  CLIENT_CREDENTIALS
+  EXTENSION
+}
+
+model Organization {
+  id          String     @id @default(uuid())
+  name        String
+  url         String?
+  address     String?
+  phoneNumber String?
+  UserPools   UserPool[]
+  createdAt   DateTime   @default(now())
+  updatedAt   DateTime   @updatedAt
+}
+
+model UserPool {
+  id              String                @id @default(uuid())
+  Organization    Organization          @relation(fields: [organizationId], references: [id])
+  organizationId  String
+  Users           User[]
+  Groups          Group[]
+  Roles           Role[]
+  Clients         oAuthClient[]
+  ResourceServers oAuthResourceServer[]
+}
+
+model Role {
+  id           String             @id @default(uuid())
+  name         String
+  description  String?
+  UserPool     UserPool           @relation(fields: [userPoolId], references: [id])
+  userPoolId   String
+  Users        User[]
+  Groups       Group[]
+  Scopes       oAuthScope[]
+  CustomScopes oAuthCustomScope[]
+  createdAt    DateTime           @default(now())
+  updatedAt    DateTime           @updatedAt
+}
+
+model oAuthClient {
+  id                   String                   @id @default(uuid())
+  name                 String                   @unique
+  secret               String                   @default(cuid())
+  UserPool             UserPool                 @relation(fields: [userPoolId], references: [id])
+  userPoolId           String
+  Grants               oAuthGrant[]
+  RedirectUris         oAuthRedirectURI[]
+  JavascriptOrigins    oAuthJavascriptOrigin[]
+  Scopes               oAuthScope[]
+  AccessTokens         oAuthAccessToken[]
+  AuthorizationCodes   oAuthAuthorizationCode[]
+  RefreshTokens        oAuthRefreshToken[]
+  ResourceServers      oAuthResourceServer[]
+  refreshTokenLifetime Int                      @default(43200)
+  accessTokenLifetime  Int                      @default(60)
+  idTokenLifetime      Int                      @default(5)
+  logo                 String
+  isTrusted            Boolean                  @default(false)
+  createdAt            DateTime                 @default(now())
+  updatedAt            DateTime                 @updatedAt
+}
+
+model oAuthScope {
+  id                 String                   @id @default(uuid())
+  name               String
+  description        String?
+  Clients            oAuthClient[]
+  AccessTokens       oAuthAccessToken[]
+  AuthorizationCodes oAuthAuthorizationCode[]
+  RefreshTokenScope  oAuthRefreshToken[]
+  Roles              Role[]
+  createdAt          DateTime                 @default(now())
+  updatedAt          DateTime                 @updatedAt
+}
+
+model oAuthGrant {
+  id        String        @id @default(uuid())
+  grantType GrantType
+  Clients   oAuthClient[]
+  createdAt DateTime      @default(now())
+  updatedAt DateTime      @updatedAt
+}
+
+model oAuthRedirectURI {
+  id            String      @id @default(uuid())
+  Client        oAuthClient @relation(fields: [oAuthClientId], references: [id])
+  oAuthClientId String
+  url           String
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+}
+
+model oAuthJavascriptOrigin {
+  id            String      @id @default(uuid())
+  Client        oAuthClient @relation(fields: [oAuthClientId], references: [id])
+  oAuthClientId String
+  uri           String
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+}
+
+model oAuthResourceServer {
+  id            String             @id @default(uuid())
+  name          String
+  identifier    String             @unique
+  UserPool      UserPool           @relation(fields: [userPoolId], references: [id])
+  userPoolId    String
+  Scopes        oAuthCustomScope[]
+  Client        oAuthClient        @relation(fields: [oAuthClientId], references: [id])
+  oAuthClientId String
+  createdAt     DateTime           @default(now())
+  updatedAt     DateTime           @updatedAt
+}
+
+model oAuthCustomScope {
+  id                    String              @id @default(uuid())
+  name                  String
+  description           String?
+  ResourceServer        oAuthResourceServer @relation(fields: [oAuthResourceServerId], references: [id])
+  oAuthResourceServerId String
+  Roles                 Role[]
+  createdAt             DateTime            @default(now())
+  updatedAt             DateTime            @updatedAt
+}
+
+model oAuthAccessToken {
+  id             String       @id @default(uuid())
+  accessToken    String       @default(uuid())
+  expirationDate DateTime
+  Scopes         oAuthScope[]
+  User           User?        @relation(fields: [userId], references: [id])
+  userId         String?
+  Client         oAuthClient  @relation(fields: [oAuthClientId], references: [id])
+  oAuthClientId  String
+  createdAt      DateTime     @default(now())
+  updatedAt      DateTime     @updatedAt
+
+  @@unique([accessToken, oAuthClientId])
+  @@unique([userId, oAuthClientId])
+}
+
+model oAuthRefreshToken {
+  id             String       @id @default(uuid())
+  refreshToken   String       @default(uuid())
+  expirationDate DateTime
+  Scopes         oAuthScope[]
+  User           User?        @relation(fields: [userId], references: [id])
+  userId         String?
+  Client         oAuthClient  @relation(fields: [oAuthClientId], references: [id])
+  oAuthClientId  String
+  createdAt      DateTime     @default(now())
+  updatedAt      DateTime     @updatedAt
+
+  @@unique([refreshToken, oAuthClientId])
+  @@unique([userId, oAuthClientId])
+}
+
+model oAuthAuthorizationCode {
+  id             String       @id @default(uuid())
+  code           String       @default(uuid(16))
+  expirationDate DateTime
+  redirectURI    String
+  Scopes         oAuthScope[]
+  User           User         @relation(fields: [userId], references: [id])
+  userId         String
+  Client         oAuthClient  @relation(fields: [oAuthClientId], references: [id])
+  oAuthClientId  String
+  createdAt      DateTime     @default(now())
+  updatedAt      DateTime     @updatedAt
+
+  @@unique([code, oAuthClientId])
+}
+
+enum Gender {
+  FEMALE
+  MALE
+  OTHER
+}
+
+model Group {
+  id          String   @id @default(uuid())
+  name        String
+  description String?
+  UserPool    UserPool @relation(fields: [userPoolId], references: [id])
+  userPoolId  String
+  Users       User[]
+  Roles       Role[]
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+}
+
+model User {
+  id                 String                   @id @default(uuid())
+  sub                String                   @unique @default(uuid())
+  username           String                   @unique
+  primaryEmail       String
+  password           String
+  isDisabled         Boolean                  @default(false)
+  Profile            Profile
+  Groups             Group[]
+  PasswordResets     PasswordReset[]
+  Roles              Role[]
+  Devices            UserDevice[]
+  AccessTokens       oAuthAccessToken[]
+  AuthorizationCodes oAuthAuthorizationCode[]
+  RefreshTokens      oAuthRefreshToken[]
+  UserPool           UserPool                 @relation(fields: [userPoolId], references: [id])
+  userPoolId         String
+  createdAt          DateTime                 @default(now())
+  updatedAt          DateTime                 @updatedAt
+}
+
+model Profile {
+  id           String    @id @default(uuid())
+  User         User      @relation(fields: [userId], references: [id])
+  Emails       Email[]
+  userId       String
+  firstName    String?   @default("")
+  lastName     String?   @default("")
+  displayName  String?
+  birthdate    DateTime?
+  gender       Gender?
+  mobileNumber String?
+  Photos       Photo[]
+  createdAt    DateTime  @default(now())
+  updatedAt    DateTime  @updatedAt
+}
+
+model Email {
+  id         String   @id @default(uuid())
+  email      String
+  isVerified Boolean  @default(false)
+  isPrimary  Boolean  @default(false)
+  Profile    Profile  @relation(fields: [profileId], references: [id])
+  profileId  String
+  userId     String
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+}
+
+model Photo {
+  id                    String   @id @default(uuid())
+  value                 String
+  isCurrentProfileImage Boolean
+  Profile               Profile  @relation(fields: [profileId], references: [id])
+  profileId             String
+  createdAt             DateTime @default(now())
+  updatedAt             DateTime @updatedAt
+}
+
+model PasswordReset {
+  id             String   @id @default(uuid())
+  User           User     @relation(fields: [userId], references: [id])
+  userId         String
+  token          String
+  expirationDate DateTime
+  createdAt      DateTime @default(now())
+  updatedAt      DateTime @updatedAt
+}
+
+model UserDevice {
+  id           String   @id @default(uuid())
+  User         User     @relation(fields: [userId], references: [id])
+  userId       String
+  deviceKey    String
+  name         String?
+  lastIP       String
+  isRemembered Boolean  @default(false)
+  SDK          String?
+  lastSeen     DateTime
+  createdAt    DateTime @default(now())
+  updatedAt    DateTime @updatedAt
+}
```


